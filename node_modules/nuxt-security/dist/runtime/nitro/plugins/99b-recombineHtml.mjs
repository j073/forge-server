import { defineNitroPlugin, getRouteRules } from "#imports";
export default defineNitroPlugin((nitroApp) => {
  nitroApp.hooks.hook("render:html", (html, { event }) => {
    const { security } = getRouteRules(event);
    if (!security?.sri && (!security?.headers || !security.headers.contentSecurityPolicy)) {
      return;
    }
    const sections = ["body", "bodyAppend", "bodyPrepend", "head"];
    const cheerios = event.context.cheerios;
    for (const section of sections) {
      html[section] = cheerios[section].map(($) => {
        const html2 = $.html();
        return html2;
      });
    }
  });
});
