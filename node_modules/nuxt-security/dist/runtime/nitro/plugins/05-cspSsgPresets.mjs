import { defineNitroPlugin, getResponseHeaders } from "#imports";
import { tryUseNuxt, useNitro } from "@nuxt/kit";
import { defu } from "defu";
import { isPrerendering } from "../utils/index.mjs";
export default defineNitroPlugin((nitroApp) => {
  nitroApp.hooks.hook("render:html", (_, { event }) => {
    if (!tryUseNuxt()) {
      return;
    }
    if (!isPrerendering(event)) {
      return;
    }
    const headers = getResponseHeaders(event);
    const nitro = useNitro();
    nitro.options.routeRules[event.path] = defu(
      { headers },
      nitro.options.routeRules[event.path]
    );
  });
});
